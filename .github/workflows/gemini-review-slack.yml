name: Notify Slack when Gemini review is done

on:
  pull_request_review:
    types: [submitted]

jobs:
  notify-slack:
    if: github.actor == 'gemini-code-assist[bot]'
    runs-on: ubuntu-latest

    steps:
      - name: Send Slack notification
        env:
          SLACK_REVIEW_WEBHOOK_URL: ${{ secrets.SLACK_REVIEW_WEBHOOK_URL }}
        run: |
          pr_url="${{ github.event.pull_request.html_url }}"
          pr_title="${{ github.event.pull_request.title }}"
          reviewer="${{ github.actor }}"
          state="${{ github.event.review.state }}"

          text="Gemini 리뷰(${state})가 등록되었습니다: <${pr_url}|${pr_title}> (by ${reviewer})"

          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\": \"${text}\"}" \
            "$SLACK_REVIEW_WEBHOOK_URL"